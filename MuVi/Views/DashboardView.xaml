<Window x:Class="MuVi.Views.DashboardView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="MuVi - Dashboard" 
        Height="900" 
        Width="1600"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        WindowState="Maximized"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <ResourceDictionary>
            <!-- Movie Card Style -->
            <Style x:Key="MovieCard" TargetType="Border">
                <Setter Property="Background" Value="{StaticResource BackgroundLightBrush}"/>
                <Setter Property="CornerRadius" Value="12"/>
                <Setter Property="Margin" Value="10"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Effect">
                    <Setter.Value>
                        <DropShadowEffect Color="Black" BlurRadius="15" ShadowDepth="5" Opacity="0.3"/>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Sidebar Button Style -->
            <Style x:Key="SidebarButton" TargetType="Button">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                <Setter Property="Height" Value="50"/>
                <Setter Property="Padding" Value="20,0"/>
                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="FontWeight" Value="Medium"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border" 
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="8"
                                    Margin="10,2">
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                VerticalAlignment="Center"
                                                Margin="{TemplateBinding Padding}"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{StaticResource BackgroundLightBrush}"/>
                                    <Setter Property="Foreground" Value="{StaticResource PrimaryPurpleLightBrush}"/>
                                </Trigger>
                                <DataTrigger Binding="{Binding IsActive, RelativeSource={RelativeSource Self}}" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryPurpleBrush}"/>
                                    <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                </DataTrigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Search Box Style -->
            <Style x:Key="SearchBox" TargetType="TextBox" BasedOn="{StaticResource ModernTextBox}">
                <Setter Property="Padding" Value="45,12,16,12"/>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Background="{StaticResource BackgroundGradientBrush}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ========== SIDEBAR ========== -->
        <Border Grid.Column="0" 
                Background="{StaticResource BackgroundMediumBrush}"
                BorderBrush="{StaticResource PrimaryPurpleBrush}"
                BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Logo & App Name -->
                <StackPanel Grid.Row="0" Margin="20,30,20,40">
                    <TextBlock Text="MuVi" 
                             Foreground="{StaticResource TextPrimaryBrush}"
                             FontSize="36"
                             FontWeight="Bold"
                             HorizontalAlignment="Center">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="{StaticResource PrimaryPurple}" 
                                            BlurRadius="20" 
                                            ShadowDepth="0" 
                                            Opacity="0.8"/>
                        </TextBlock.Effect>
                    </TextBlock>
                    <TextBlock Text="Nơi điện ảnh kể câu chuyện" 
                             Foreground="{StaticResource TextHintBrush}"
                             FontSize="11"
                             HorizontalAlignment="Center"
                             Margin="0,5,0,0"/>
                </StackPanel>

                <!-- Navigation Menu -->
                <ScrollViewer Grid.Row="1" 
                            VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Disabled">
                    <StackPanel>
                        <!-- Divider -->
                        <Border Height="1" 
                                Background="#3A3A3A" 
                                Margin="20,20"/>

                        <!-- Home -->
                        <Button x:Name="btnHome"
                                Style="{StaticResource SidebarButton}"
                                Click="btnHome_Click"
                                Tag="Home">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="/Assets/Icons/icons8-home-page-50.png" Width="20" Height="20" Margin="0,0,12,0"/>
                                <TextBlock Text="Trang chủ" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <!-- Movies -->
                        <Button x:Name="btnMovies"
                                Style="{StaticResource SidebarButton}"
                                Click="btnMovies_Click"
                                Tag="Movies">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="/Assets/Icons/icons8-movies-60.png" Width="20" Height="20" Margin="0,0,12,0"/>
                                <TextBlock Text="Phim lẻ" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <!-- Series -->
                        <Button x:Name="btnSeries"
                                Style="{StaticResource SidebarButton}"
                                Click="btnSeries_Click"
                                Tag="Series">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="/Assets/Icons/icons8-series-48.png" Width="20" Height="20" Margin="0,0,12,0"/>
                                <TextBlock Text="Phim bộ" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <!-- Favorites -->
                        <Button x:Name="btnFavorites"
                                Style="{StaticResource SidebarButton}"
                                Click="btnFavorites_Click"
                                Tag="Favorites">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="/Assets/Icons/icons8-heart-48.png" Width="20" Height="20" Margin="0,0,12,0"/>
                                <TextBlock Text="Yêu thích" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <!-- History -->
                        <Button x:Name="btnHistory"
                                Style="{StaticResource SidebarButton}"
                                Click="btnHistory_Click"
                                Tag="History">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="/Assets/Icons/icons8-history-50.png" Width="20" Height="20" Margin="0,0,12,0"/>
                                <TextBlock Text="Lịch sử xem" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <!-- Thay thế phần Genre trong Sidebar của DashboardView.xaml -->

                        <!-- Genre Button với Popup -->
                        <Button x:Name="btnGenres"
                                Style="{StaticResource SidebarButton}"
                                Tag="Genres"
                                MouseEnter="btnGenres_MouseEnter"
                                MouseLeave="btnGenres_MouseLeave">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="/Assets/Icons/icons8-list-view-60.png" Width="20" Height="20" Margin="0,0,12,0"/>
                                <TextBlock Text="Thể loại" VerticalAlignment="Center"/>
                                <Image Source="/Assets/Icons/icons8-expand-arrow-48.png" Width="15" Height="15" Margin="10,0,0,0"/>
                            </StackPanel>
                        </Button>

                        <!-- Popup cho Genre -->
                        <Popup x:Name="popupGenres"
                               PlacementTarget="{Binding ElementName=btnGenres}"
                               Placement="Bottom"
                               HorizontalOffset="30"
                               d:IsOpen="True"
                               StaysOpen="False"
                               AllowsTransparency="True"
                               MouseLeave="popupGenres_MouseLeave">
                            <Border Style="{StaticResource ModernPopupBorder}"
                                    Padding="10"
                                    MinWidth="200">
                                <StackPanel>
                                    <!-- Genre Items -->
                                    <Button Content="Tất cả thể loại" 
                                            Tag="All"
                                            Style="{StaticResource GenrePopupItem}"
                                            Click="GenreItem_Click"/>

                                    <Button Content="Hành động" 
                                            Tag="Action"
                                            Style="{StaticResource GenrePopupItem}"
                                            Click="GenreItem_Click"/>

                                    <Button Content="Tình cảm" 
                                            Tag="Romance"
                                            Style="{StaticResource GenrePopupItem}"
                                            Click="GenreItem_Click"/>

                                    <Button Content="Hài" 
                                            Tag="Comedy"
                                            Style="{StaticResource GenrePopupItem}"
                                            Click="GenreItem_Click"/>

                                </StackPanel>
                            </Border>
                        </Popup>

                        <!-- Divider -->
                        <Border Height="1" 
                                Background="#3A3A3A" 
                                Margin="20,20"/>


                    </StackPanel>
                </ScrollViewer>

                <!-- User Profile -->
                <Border Grid.Row="2" 
                        Background="{StaticResource BackgroundLightBrush}"
                        Padding="15"
                        Margin="20"
                        CornerRadius="12"
                        Cursor="Hand"
                        MouseLeftButtonDown="UserProfile_Click">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Avatar -->
                        <Ellipse Grid.Column="0" Width="40" Height="40" Stroke="#8B5CF6" StrokeThickness="1">
                            <Ellipse.Fill>
                                <ImageBrush ImageSource="{Binding Avatar}" Stretch="UniformToFill"/>
                            </Ellipse.Fill>
                        </Ellipse>

                        <!-- User Info -->
                        <StackPanel Grid.Column="1" 
                                  Margin="12,0,0,0"
                                  VerticalAlignment="Center">
                            <TextBlock Text="{Binding Username}" 
                                     Foreground="{StaticResource TextPrimaryBrush}"
                                     FontSize="13"
                                     FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding UserRole}" 
                                     Foreground="{StaticResource TextHintBrush}"
                                     FontSize="11"/>
                        </StackPanel>

                        <!-- Logout Icon -->
                        <Image Grid.Column="2" 
                             Source="/Assets/Icons/icons8-logout-64.png"
                             Width="30" Height="30"
                             VerticalAlignment="Center"
                             x:Name="imgLogout"
                             MouseLeftButtonDown="Logout_Click"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- ========== MAIN CONTENT ========== -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- ========== HEADER ========== -->
            <Border Grid.Row="0" 
                    Background="{StaticResource BackgroundMediumBrush}"
                    BorderBrush="#3A3A3A"
                    BorderThickness="0,0,0,1"
                    Padding="30,20">
                <Grid>
                    <!-- Search Box -->
                    <Grid HorizontalAlignment="Center" Width="500">
                        <TextBox x:Name="txtSearch"
                                 Style="{StaticResource SearchBox}"
                                 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                 KeyDown="txtSearch_KeyDown"/>
                    </Grid>

                    <!-- Close Button -->
                    <Button x:Name="btnClose"
        HorizontalAlignment="Right" 
        VerticalAlignment="Center"
        Width="36" Height="36"
        Background="Transparent"
        Foreground="{StaticResource TextSecondaryBrush}"
        BorderThickness="0"
        Cursor="Hand"
        Click="btnClose_Click">
                        <Image Source="/Assets/Icons/icons8-close-window-64.png"/>
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="border" 
                              Background="{TemplateBinding Background}"
                              CornerRadius="18">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="Transparent"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>

            <!-- ========== CONTENT AREA ========== -->
            <ScrollViewer Grid.Row="1" 
                        VerticalScrollBarVisibility="Auto"
                        HorizontalScrollBarVisibility="Disabled">
                <StackPanel Margin="30,20">

                    <!-- Page Title -->
                    <!--<TextBlock x:Name="txtPageTitle"
                             Text="{Binding PageTitle}"
                             Style="{StaticResource TitleLabel}"
                             FontSize="28"
                             Margin="0,0,0,20"/>-->

                    <!-- Featured Section -->
                    <Grid x:Name="FeaturedSection" Margin="0,0,0,40">
                        <Border Height="400"
                                CornerRadius="16"
                                Background="{StaticResource BackgroundLightBrush}">
                            <Border.Effect>
                                <DropShadowEffect Color="{StaticResource PrimaryPurple}" 
                                                BlurRadius="40" 
                                                ShadowDepth="0" 
                                                Opacity="0.3"/>
                            </Border.Effect>
                            <Grid>
                                <!-- Featured Movie Background -->
                                <Image
                                     Stretch="UniformToFill"
                                     Opacity="1"/>

                                <!-- Gradient Overlay -->
                                <Border>
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                            <GradientStop Color="Transparent" Offset="0"/>
                                            <GradientStop Color="#0F0F0F" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                </Border>

                                <!-- Featured Movie Info -->
                                <StackPanel VerticalAlignment="Bottom" 
                                          Margin="40,0,40,40">
                                    <TextBlock x:Name="txtFeaturedTitle"
                                             Text="Tên Phim Nổi Bật"
                                             Foreground="White"
                                             FontSize="42"
                                             FontWeight="Bold"
                                             Margin="0,0,0,10"/>

                                    <StackPanel>

                                    </StackPanel>

                                    <TextBlock x:Name="txtFeaturedDesc"
                                             Text="Mô tả ngắn về bộ phim nổi bật..."
                                             Foreground="{StaticResource TextSecondaryBrush}"
                                             FontSize="16"
                                             TextWrapping="Wrap"
                                             MaxWidth="700"
                                             HorizontalAlignment="Left"
                                             Margin="0,0,0,20"/>
                                    <StackPanel Orientation="Horizontal">
                                        <Button
                                              Style="{StaticResource PrimaryButton}"
                                              Click="btnWatchNow_Click"
                                              Margin="0,0,20,0">
                                            <Image Source="/Assets/Icons/icons8-play-48.png" Width="20" Margin="5" />
                                        </Button>

                                        <Button
                                              Style="{StaticResource SecondaryButton}"
                                              Click="btnAddToFavorite_Click"
                                              Margin="0,0,10,0">
                                            <Image Source="/Assets/Icons/icons8-heart-48.png" Width="20" Margin="5" />
                                        </Button>

                                        <Button
                                              Style="{StaticResource SecondaryButton}"
                                              Click="btnDetails_Click">
                                            <Image Source="/Assets/Icons/icons8-info-48.png" Width="20" Margin="5" />
                                        </Button>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>

                    <!-- Trending Movies -->
                    <StackPanel Margin="0,0,0,30">
                        <TextBlock Text="🔥 Xu hướng"
                                 Foreground="{StaticResource TextPrimaryBrush}"
                                 FontSize="22"
                                 FontWeight="SemiBold"
                                 Margin="0,0,0,15"/>
                        <ItemsControl x:Name="icTrending"
                                    ItemsSource="{Binding TrendingMovies}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource MovieCard}"
                                            Width="200" Height="320"
                                            MouseLeftButtonDown="MovieCard_Click"
                                            Tag="{Binding MovieID}">
                                        <Grid>
                                            <!-- Movie Poster -->
                                            <Image Source="{Binding PosterPath}"
                                                 Stretch="UniformToFill"/>

                                            <!-- Gradient Overlay -->
                                            <Border>
                                                <Border.Background>
                                                    <LinearGradientBrush StartPoint="0,0.7" EndPoint="0,1">
                                                        <GradientStop Color="Transparent" Offset="0"/>
                                                        <GradientStop Color="#CC000000" Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Border.Background>
                                            </Border>

                                            <!-- Movie Info -->
                                            <StackPanel VerticalAlignment="Bottom" 
                                                      Margin="12">
                                                <TextBlock Text="{Binding Title}"
                                                         Foreground="White"
                                                         FontSize="14"
                                                         FontWeight="SemiBold"
                                                         TextTrimming="CharacterEllipsis"
                                                         MaxHeight="40"
                                                         TextWrapping="Wrap"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                    <TextBlock Text="⭐"
                                                             FontSize="12"
                                                             Margin="0,0,4,0"/>
                                                    <TextBlock Text="{Binding Rating}"
                                                             Foreground="{StaticResource AccentPurpleBrush}"
                                                             FontSize="12"
                                                             FontWeight="SemiBold"/>
                                                    <TextBlock Text="{Binding ReleaseYear}"
                                                             Foreground="{StaticResource TextHintBrush}"
                                                             FontSize="12"
                                                             Margin="10,0,0,0"/>
                                                </StackPanel>
                                            </StackPanel>

                                            <!-- Favorite Button -->
                                            <Button Width="32" Height="32"
                                                  Background="#80000000"
                                                  BorderThickness="0"
                                                  VerticalAlignment="Top"
                                                  HorizontalAlignment="Right"
                                                  Margin="10"
                                                  Cursor="Hand"
                                                  Click="btnAddToFavorite_Click"
                                                  Tag="{Binding MovieID}">
                                                <Image Source="/Assets/Icons/icons8-heart-48.png" Width="18"/>
                                            </Button>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                    <!-- New Releases -->
                    <StackPanel Margin="0,0,0,30">
                        <TextBlock Text="🆕 Mới phát hành"
                                 Foreground="{StaticResource TextPrimaryBrush}"
                                 FontSize="22"
                                 FontWeight="SemiBold"
                                 Margin="0,0,0,15"/>
                        <ItemsControl x:Name="icNewReleases"
                                    ItemsSource="{Binding NewReleases}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource MovieCard}"
                                            Width="200" Height="320"
                                            MouseLeftButtonDown="MovieCard_Click"
                                            Tag="{Binding MovieID}">
                                        <Grid>
                                            <Image Source="{Binding PosterPath}"
                                                 Stretch="UniformToFill"/>
                                            <Border>
                                                <Border.Background>
                                                    <LinearGradientBrush StartPoint="0,0.7" EndPoint="0,1">
                                                        <GradientStop Color="Transparent" Offset="0"/>
                                                        <GradientStop Color="#CC000000" Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Border.Background>
                                            </Border>
                                            <StackPanel VerticalAlignment="Bottom" Margin="12">
                                                <TextBlock Text="{Binding Title}"
                                                         Foreground="White"
                                                         FontSize="14"
                                                         FontWeight="SemiBold"
                                                         TextTrimming="CharacterEllipsis"
                                                         MaxHeight="40"
                                                         TextWrapping="Wrap"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                    <TextBlock Text="⭐" FontSize="12" Margin="0,0,4,0"/>
                                                    <TextBlock Text="{Binding Rating}"
                                                             Foreground="{StaticResource AccentPurpleBrush}"
                                                             FontSize="12"
                                                             FontWeight="SemiBold"/>
                                                    <TextBlock Text="{Binding ReleaseYear}"
                                                             Foreground="{StaticResource TextHintBrush}"
                                                             FontSize="12"
                                                             Margin="10,0,0,0"/>
                                                </StackPanel>
                                            </StackPanel>
                                            <Button Width="32" Height="32"
                                                  Background="#80000000"
                                                  BorderThickness="0"
                                                  VerticalAlignment="Top"
                                                  HorizontalAlignment="Right"
                                                  Margin="10"
                                                  Cursor="Hand"
                                                  Click="btnAddToFavorite_Click"
                                                  Tag="{Binding MovieID}">
                                                <Image Source="/Assets/Icons/icons8-heart-48.png" Width="18"/>
                                            </Button>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Grid>
</Window>